{% extends "layout.html" %}
{% load static %}
{% block title %}Home{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6 offset-md-3 mt-5">
                    <h2>Test Page</h2>
                    <hr class="top-0" />
                </div>
            </div>
        </div>

        <div class="col-md-4">

            <h3>Select or upload dataset(s)</h3>

            <!--  DataSet Jstree Area  -->
            <div class="table-div no-left-margin">
                <div id="data_set_div" class="text-left">
                    <div id="data_set_folder"></div>
                </div>
            </div>
            <!--  #END DataSet Jstree Area  -->

            <!--  DataSet Uploading Area  -->
            <div class="upload-div" id="data_set-area">
                <form class="drop-area">
                    <p>Drag & Drop or Click!</p>
                    <input type="file" class="fileElem" accept="*/*" multiple>
                    <progress class="progress-bar" max=100 value=0></progress>
                </form>
                <div class="gallery"></div>
            </div>
            <!-- #END DataSet Uploading Area  -->
        </div>
        <!--# END Uploading Area    -->

        <!--  Processing Status    -->
        <div class="col-md-4 status-div">
            <h3>Status</h3>
            <div class="status mt-4">
                <textarea class="form-control status-text" id="status-text" disabled>...</textarea>
            </div>
            <div class="mt-2">
                <a onclick="download_cert();" id="down_cert" class="hidden text-warning">Download certificate.txt</a>
            </div>
        </div>
        <!--# END Processing Status  -->

        <!--# Processing Result -->
        <div class="col-md-4 result-div">
            <h3>Results</h3>
            <!--  Hierarchy View  -->
            <br>
            <div id="hierarchy_div" style="display: block;">
                <div id="hierarchy"></div>
            </div>
            <!--  # END Hierarchy View  -->

            <!-- Spinner -->
            <div class="spinner mt-5" style="display:block;">
                <div class="text-center pt-5">
                    <h6 class="mb-lg"><sup><em class="fa fa-cog fa-2x text-muted fa-spin text-info"></em></sup>
                       <em class="fa fa-cog fa-5x text-muted fa-spin text-purple"></em>
                       <em class="fa fa-cog fa-lg text-muted fa-spin text-success"></em>
                    </h6>
                </div>
                <h3 class="mt-5">Processing...</h3>
            </div>
            <!-- #END Spinner -->

        </div>
        <!--# END Processing Result  -->
    </div>
{% endblock %}

{% block js_content %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.9/jstree.min.js"></script>
    <script src="{% static 'js/jstree_utils.js' %}"></script>
    <script src="{% static 'js/jstree_process.js' %}"></script>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.617.0.min.js"></script>
    <script src="{% static 'js/fileupload/polyfill.js' %}"></script>
    <script src="{% static 'js/fileupload/file_upload.js' %}"></script>

    <script>
        var configs = [];
        var data_sets = [];

        // variables to show jstree
        var results_links = [];

        var detail_flag = true;  // flag to show detail of data_set and config.

        var id1, id2;
        var id1 = "{{id1}}";
        var id2 = "{{id2}}";
        var processing_status = false;
        var data_set_dir = "{{data_set_dir}}";
        var bucket = "{{bucket}}";
        var ana_id = {{analysis.id}};
        var ana_prefix = '{{analysis.result_prefix}}';
        var data_set_area = new FileUpload();
        var timestamp = 0;
    </script>

    <script src="{% static 'js/process.js' %}"></script>

    <script>
        data_set_area.init("data_set-area", id1, id2, bucket, data_set_dir, "", submit_trigger, true);
    </script>
{% endblock %}